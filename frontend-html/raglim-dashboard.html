<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="RAGLLM Testing System Dashboard">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>RAGLLM Testing System</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <!-- Chart.js -->
    <script src="js/config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js" crossorigin="anonymous"></script>
    <!-- 自定义CSS -->
    <link href="css/raglim-design.css" rel="stylesheet">
</head>
<body>
    <div class="layout-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-cube"></i>
                <span>RAGLLM Test Suite</span>
            </div>
            <ul class="sidebar-menu">
                <li class="active" data-view="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li data-view="test-cases">
                    <a href="test-cases.html" style="color: inherit; text-decoration: none; display: flex; align-items: center;">
                        <i class="fas fa-vial"></i>
                        <span>Test Cases</span>
                    </a>
                </li>
                <li data-view="results">
                    <i class="fas fa-chart-bar"></i>
                    <span>Results</span>
                </li>
                <li data-view="performance">
                    <i class="fas fa-bolt"></i>
                    <span>Performance</span>
                </li>
                <li data-view="metrics">
                    <i class="fas fa-chart-line"></i>
                    <span>Metrics</span>
                </li>
                <li data-view="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
            <div class="system-status">
                <div class="status-indicator"></div>
                <span>All systems operational</span>
            </div>
            <div class="version-info">
                Version 2.3.4
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <div class="top-nav">
                <button class="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search test cases...">
                </div>
                <div class="nav-icons">
                    <i class="fas fa-bell"></i>
                    <i class="fas fa-user-circle"></i>
                </div>
            </div>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- 仪表板视图 -->
                <div id="dashboard-view" class="view-section">
                    <!-- 统计卡片 -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="stat-number total-cases">0</div>
                                <div class="stat-label">Total Samples</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="stat-number average-score">0.0</div>
                                <div class="stat-label">Average Score</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="stat-number success-rate">0.0</div>
                                <div class="stat-label">Highest: N/A</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                                <div class="stat-number">0.0</div>
                                <div class="stat-label">Lowest: N/A</div>
                            </div>
                        </div>
                    </div>

                    <!-- 图表区域 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Product Score Distribution</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary download-chart" data-chart="dimension-chart">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2 expand-chart" data-chart="dimension-chart">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="dimension-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>MAG Correlation Chart</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary download-chart" data-chart="correlation-chart">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2 expand-chart" data-chart="correlation-chart">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="correlation-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Dimension Score Distribution</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary download-chart" data-chart="distribution-chart">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2 expand-chart" data-chart="distribution-chart">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="distribution-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                <!-- 测试用例视图 -->
                <div id="test-cases-view" class="view-section d-none">
                    <h2 class="mb-4">测试用例 <span class="text-muted">Test Cases</span></h2>

                    <!-- 搜索和过滤区域 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" placeholder="Search test cases...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown">
                                    <span>Product Family</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">All Products</a></li>
                                    <li><a class="dropdown-item" href="#">Enterprise Storage</a></li>
                                    <li><a class="dropdown-item" href="#">Cloud Services</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary dropdown-toggle w-100 d-flex justify-content-between align-items-center" type="button" data-bs-toggle="dropdown">
                                    <span>Sort By</span>
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Date (Newest)</a></li>
                                    <li><a class="dropdown-item" href="#">Date (Oldest)</a></li>
                                    <li><a class="dropdown-item" href="#">Name (A-Z)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 添加测试用例按钮 -->
                    <div class="d-flex justify-content-end mb-3">
                        <button class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>
                            Add New Test Case
                        </button>
                    </div>

                    <!-- 测试用例表格 -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="selectAll">
                                    </div>
                                </div>
                                <div class="col-1">ID</div>
                                <div class="col-1">Number</div>
                                <div class="col-4">Question</div>
                                <div class="col-2">Complexity</div>
                                <div class="col-2">Category</div>
                                <div class="col-1">Actions</div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <!-- 测试用例项 1 -->
                                <div class="list-group-item py-3">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox">
                                            </div>
                                        </div>
                                        <div class="col-1">001</div>
                                        <div class="col-1">PN-2389</div>
                                        <div class="col-4">
                                            How to configure the system with optimal settings for high-throughput applications?
                                        </div>
                                        <div class="col-2">
                                            <span class="badge bg-primary-light text-primary-deep">Configuration</span>
                                        </div>
                                        <div class="col-2">
                                            <div class="d-flex align-items-center">
                                                <span class="badge rounded-pill bg-success-light text-success me-2"></span>
                                                <span>Passed</span>
                                            </div>
                                        </div>
                                        <div class="col-1">
                                            <div class="d-flex">
                                                <button class="btn btn-sm btn-icon btn-outline-secondary me-1">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-icon btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 测试用例项 2 -->
                                <div class="list-group-item py-3">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox">
                                            </div>
                                        </div>
                                        <div class="col-1">002</div>
                                        <div class="col-1">PN-2390</div>
                                        <div class="col-4">
                                            What are the specifications for integrating with third-party authentication systems?
                                        </div>
                                        <div class="col-2">
                                            <span class="badge bg-warning-light text-warning">Integration</span>
                                        </div>
                                        <div class="col-2">
                                            <div class="d-flex align-items-center">
                                                <span class="badge rounded-pill bg-warning-light text-warning me-2"></span>
                                                <span>Partial</span>
                                            </div>
                                        </div>
                                        <div class="col-1">
                                            <div class="d-flex">
                                                <button class="btn btn-sm btn-icon btn-outline-secondary me-1">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-icon btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 结果分析视图 -->
                <div id="results-view" class="view-section d-none">
                    <h2 class="mb-4">结果分析 <span class="text-muted">Results Analysis</span></h2>

                    <!-- 测试结果详情 -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="d-flex mb-3">
                                        <div class="me-4">
                                            <div class="text-muted small">Test ID:</div>
                                            <div class="fw-bold">TS-42875</div>
                                        </div>
                                        <div class="me-4">
                                            <div class="text-muted small">Part Number:</div>
                                            <div class="fw-bold">PN-3875</div>
                                        </div>
                                        <div>
                                            <div class="text-muted small">Date:</div>
                                            <div class="fw-bold">2023-11-15</div>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="text-muted small">Product Family:</div>
                                        <div>Enterprise Storage</div>
                                    </div>
                                    <div>
                                        <div class="text-muted small">Category:</div>
                                        <div><span class="badge bg-warning-light text-warning">Integration</span></div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-center">
                                    <div class="display-4 fw-bold text-primary-light">4.2</div>
                                    <div class="text-muted">Average Score</div>
                                    <div class="mt-2 text-success">Good Performance</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 标准答案与LLM答案对比 -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-light">
                                    <i class="fas fa-book me-2"></i>
                                    Standard Answer
                                </div>
                                <div class="card-body">
                                    <p>The integration process requires first checking compatibility with legacy systems by examining API versions and protocols. Potential issues include outdated authentication methods, data format inconsistencies, and performance bottlenecks at integration points.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header bg-light">
                                    <i class="fas fa-robot me-2"></i>
                                    LLM Answer
                                </div>
                                <div class="card-body">
                                    <p>To integrate the component with legacy systems, first verify API compatibility by checking version support and protocol alignments. The main compatibility challenges include authentication differences, data format inconsistencies, and performance issues at integration points.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 指标视图 -->
                <div id="metrics-view" class="view-section d-none">
                    <h2 class="mb-4">评估指标 <span class="text-muted">Metrics</span></h2>

                    <!-- 指标卡片 -->
                    <div class="row g-3">
                        <!-- 幻觉控制指标 -->
                        <div class="col-md-6">
                            <div class="metric-config-card">
                                <div class="metric-config-header">
                                    <div class="metric-config-icon bg-primary-light">
                                        <i class="fas fa-shield-alt text-primary-deep"></i>
                                    </div>
                                    <div class="metric-config-title">
                                        <h3>Hallucination Control</h3>
                                        <p>评估模型输出内容的真实性和准确性</p>
                                    </div>
                                </div>
                                <div class="metric-config-body">
                                    <div class="metric-config-chart">
                                        <div class="metric-score">
                                            <span class="score-value">80</span>
                                            <span class="score-max">/100</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-primary" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="metric-config-settings mt-4">
                                        <div class="weight-slider">
                                            <label>
                                                <span>权重</span>
                                                <span class="weight-value">30%</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="30">
                                        </div>
                                        <div class="threshold-slider">
                                            <label>
                                                <span>阈值</span>
                                                <span class="threshold-value">70</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="70">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 质量指标 -->
                        <div class="col-md-6">
                            <div class="metric-config-card">
                                <div class="metric-config-header">
                                    <div class="metric-config-icon bg-success-light">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                    <div class="metric-config-title">
                                        <h3>Quality</h3>
                                        <p>评估模型输出内容的整体质量和完整性</p>
                                    </div>
                                </div>
                                <div class="metric-config-body">
                                    <div class="metric-config-chart">
                                        <div class="metric-score">
                                            <span class="score-value">70</span>
                                            <span class="score-max">/100</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="metric-config-settings mt-4">
                                        <div class="weight-slider">
                                            <label>
                                                <span>权重</span>
                                                <span class="weight-value">25%</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="25">
                                        </div>
                                        <div class="threshold-slider">
                                            <label>
                                                <span>阈值</span>
                                                <span class="threshold-value">65</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="65">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 专业性指标 -->
                        <div class="col-md-6">
                            <div class="metric-config-card">
                                <div class="metric-config-header">
                                    <div class="metric-config-icon bg-danger-light">
                                        <i class="fas fa-graduation-cap text-danger"></i>
                                    </div>
                                    <div class="metric-config-title">
                                        <h3>Professionalism</h3>
                                        <p>评估模型输出内容的专业水平和领域知识</p>
                                    </div>
                                </div>
                                <div class="metric-config-body">
                                    <div class="metric-config-chart">
                                        <div class="metric-score">
                                            <span class="score-value">65</span>
                                            <span class="score-max">/100</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="metric-config-settings mt-4">
                                        <div class="weight-slider">
                                            <label>
                                                <span>权重</span>
                                                <span class="weight-value">20%</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="20">
                                        </div>
                                        <div class="threshold-slider">
                                            <label>
                                                <span>阈值</span>
                                                <span class="threshold-value">60</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="60">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 实用性指标 -->
                        <div class="col-md-6">
                            <div class="metric-config-card">
                                <div class="metric-config-header">
                                    <div class="metric-config-icon bg-warning-light">
                                        <i class="fas fa-lightbulb text-warning"></i>
                                    </div>
                                    <div class="metric-config-title">
                                        <h3>Usefulness</h3>
                                        <p>评估模型输出内容的实用性和解决问题的能力</p>
                                    </div>
                                </div>
                                <div class="metric-config-body">
                                    <div class="metric-config-chart">
                                        <div class="metric-score">
                                            <span class="score-value">50</span>
                                            <span class="score-max">/100</span>
                                        </div>
                                        <div class="progress mt-2">
                                            <div class="progress-bar bg-warning" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="metric-config-settings mt-4">
                                        <div class="weight-slider">
                                            <label>
                                                <span>权重</span>
                                                <span class="weight-value">25%</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="25">
                                        </div>
                                        <div class="threshold-slider">
                                            <label>
                                                <span>阈值</span>
                                                <span class="threshold-value">50</span>
                                            </label>
                                            <input type="range" class="form-range" min="0" max="100" step="5" value="50">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 平均分数 -->
                        <div class="col-12">
                            <div class="metric-config-card">
                                <div class="metric-config-header">
                                    <div class="metric-config-icon bg-info-light">
                                        <i class="fas fa-calculator text-primary-light"></i>
                                    </div>
                                    <div class="metric-config-title">
                                        <h3>Average Score</h3>
                                        <p>所有指标的加权平均分数</p>
                                    </div>
                                </div>
                                <div class="metric-config-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-4">
                                            <div class="metric-score text-center">
                                                <span class="score-value display-4">66.5</span>
                                                <span class="score-max">/100</span>
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <div class="average-score-formula">
                                                <p class="mb-2">计算公式:</p>
                                                <div class="formula-display">
                                                    <span>80 × 30% + 70 × 25% + 65 × 20% + 50 × 25% = 66.5</span>
                                                </div>
                                            </div>
                                            <div class="threshold-slider mt-4">
                                                <label>
                                                    <span>及格阈值</span>
                                                    <span class="threshold-value">60</span>
                                                </label>
                                                <input type="range" class="form-range" min="0" max="100" step="5" value="60">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 性能视图 -->
                <div id="performance-view" class="view-section d-none">
                    <h2 class="mb-4">性能分析 <span class="text-muted">Performance Analysis</span></h2>

                    <!-- 过滤器 -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-calendar text-muted"></i>
                                </span>
                                <select class="form-select border-start-0">
                                    <option>Last 7 days</option>
                                    <option>Last 30 days</option>
                                    <option>Last 90 days</option>
                                    <option>Custom range</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-filter text-muted"></i>
                                </span>
                                <select class="form-select border-start-0">
                                    <option>All Product Families</option>
                                    <option>Enterprise Storage</option>
                                    <option>Cloud Services</option>
                                    <option>Security Solutions</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-sort-amount-down text-muted"></i>
                                </span>
                                <select class="form-select border-start-0">
                                    <option>All Complexity Levels</option>
                                    <option>Low Complexity</option>
                                    <option>Medium Complexity</option>
                                    <option>High Complexity</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 图表区域 -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Time Trend</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="time-trend-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Product Family Comparison</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="product-comparison-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Complexity Distribution</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="complexity-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Score Distribution</span>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary ms-2">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="score-distribution-chart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 详细数据表格 -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Detailed Performance Data</span>
                            <button class="btn btn-primary">
                                <i class="fas fa-file-export me-2"></i>
                                Export Report
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Test ID</th>
                                            <th>Product Family</th>
                                            <th>Complexity</th>
                                            <th>Hallucination</th>
                                            <th>Quality</th>
                                            <th>Professionalism</th>
                                            <th>Usefulness</th>
                                            <th>Average</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>2023-05-18</td>
                                            <td>TS-001</td>
                                            <td>Enterprise Storage</td>
                                            <td>Medium</td>
                                            <td>85</td>
                                            <td>78</td>
                                            <td>72</td>
                                            <td>65</td>
                                            <td>75.0</td>
                                        </tr>
                                        <tr>
                                            <td>2023-05-17</td>
                                            <td>TS-002</td>
                                            <td>Cloud Services</td>
                                            <td>High</td>
                                            <td>92</td>
                                            <td>85</td>
                                            <td>80</td>
                                            <td>75</td>
                                            <td>83.0</td>
                                        </tr>
                                        <tr>
                                            <td>2023-05-16</td>
                                            <td>TS-003</td>
                                            <td>Security Solutions</td>
                                            <td>Low</td>
                                            <td>78</td>
                                            <td>72</td>
                                            <td>68</td>
                                            <td>60</td>
                                            <td>69.5</td>
                                        </tr>
                                        <tr>
                                            <td>2023-05-15</td>
                                            <td>TS-004</td>
                                            <td>Enterprise Storage</td>
                                            <td>High</td>
                                            <td>88</td>
                                            <td>82</td>
                                            <td>75</td>
                                            <td>70</td>
                                            <td>78.8</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 设置视图 -->
                <div id="settings-view" class="view-section d-none">
                    <h2 class="mb-4">系统设置 <span class="text-muted">Settings</span></h2>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush">
                                        <a href="#" class="list-group-item list-group-item-action active">
                                            <i class="fas fa-sliders-h me-2"></i>
                                            General
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <i class="fas fa-chart-pie me-2"></i>
                                            Metrics
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <i class="fas fa-database me-2"></i>
                                            Data Management
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <i class="fas fa-users me-2"></i>
                                            User Access
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <i class="fas fa-bell me-2"></i>
                                            Notifications
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <i class="fas fa-plug me-2"></i>
                                            Integrations
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <!-- General Settings Card -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">General Settings</h5>
                                </div>
                                <div class="card-body">
                                    <form>
                                        <div class="mb-3">
                                            <label class="form-label">System Name</label>
                                            <input type="text" class="form-control" value="RAGLLM Test Suite">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Default Language</label>
                                            <select class="form-select">
                                                <option value="en">English</option>
                                                <option value="zh">中文</option>
                                                <option value="es">Español</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Date Format</label>
                                            <select class="form-select">
                                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Theme</label>
                                            <select class="form-select">
                                                <option value="light">Light</option>
                                                <option value="dark">Dark</option>
                                                <option value="system">System Default</option>
                                            </select>
                                        </div>
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                            <label class="form-check-label" for="autoRefresh">Auto-refresh Dashboard</label>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Refresh Interval (seconds)</label>
                                            <input type="number" class="form-control" value="300">
                                        </div>
                                        <button type="submit" class="btn btn-primary">Save Changes</button>
                                    </form>
                                </div>
                            </div>

                            <!-- Evaluation Weights Card -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Evaluation Weights</h5>
                                    <small class="text-muted">Adjust the importance of each evaluation dimension</small>
                                </div>
                                <div class="card-body">
                                    <div id="weight-sliders">
                                        <!-- Weight sliders will be dynamically generated here -->
                                        <div class="text-center text-muted py-4">
                                            <i class="fas fa-spinner fa-spin me-2"></i>
                                            Loading evaluation dimensions...
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <button type="button" class="btn btn-primary me-2" id="apply-weights">Apply Weights</button>
                                        <button type="button" class="btn btn-outline-secondary" id="reset-weights">Reset to Default</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 其他视图可以根据需要添加 -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Main JS -->
    <script src="js/main.js"></script>

    <!-- 自定义脚本 -->
    <script>
        // 等待页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 加载统计数据
            loadDashboardStats();

            // 初始化图表
            initializeCharts();

            // 侧边栏菜单切换
            const menuItems = document.querySelectorAll('.sidebar-menu li');
            const viewSections = document.querySelectorAll('.view-section');

            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 跳过包含链接的菜单项
                    if (this.querySelector('a')) {
                        return;
                    }

                    // 移除所有活动状态
                    menuItems.forEach(mi => mi.classList.remove('active'));
                    // 添加当前活动状态
                    this.classList.add('active');

                    // 显示对应视图
                    const viewName = this.getAttribute('data-view');
                    viewSections.forEach(section => {
                        section.classList.add('d-none');
                        if (section.id === viewName + '-view') {
                            section.classList.remove('d-none');
                        }
                    });

                    // 调用相应的更新函数
                    if (viewName === 'settings' && typeof updateSettingsView === 'function') {
                        updateSettingsView();
                    }
                });
            });

            // 移动端菜单切换
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const sidebar = document.querySelector('.sidebar');

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                });
            }

            // 点击内容区域关闭移动端菜单
            document.querySelector('.content-area').addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('show');
                }
            });
        });

        // 加载仪表板统计数据
        async function loadDashboardStats() {
            try {
                console.log('正在从后端获取统计数据...');

                // 构建API URL
                const apiBaseUrl = getApiBaseUrl();
                const url = `${apiBaseUrl}/api/stats`;
                console.log('API URL:', url);
                console.log('配置文件API地址:', window.appConfig ? window.appConfig.apiBaseUrl : '未找到配置文件');

                // 发起请求
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                console.log('响应状态:', response.status, response.statusText);
                console.log('响应头:', [...response.headers.entries()]);

                // 检查响应状态
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API错误响应:', errorText);
                    throw new Error(`API请求失败: ${response.status} ${response.statusText}, 响应内容: ${errorText}`);
                }

                // 解析响应数据
                const responseText = await response.text();
                console.log('原始响应文本:', responseText);

                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON解析失败:', parseError);
                    throw new Error(`JSON解析失败: ${parseError.message}, 原始响应: ${responseText}`);
                }

                console.log('解析后的API响应数据:', data);

                // 检查数据格式
                if (!data || !data.stats) {
                    console.warn('后端返回的统计数据格式不正确:', data);
                    // 显示错误信息到页面
                    showApiError('后端返回的数据格式不正确', data);
                    return;
                }

                // 更新统计卡片
                updateStatCards(data.stats);

                console.log('统计数据加载成功:', data.stats);
            } catch (error) {
                console.error('获取统计数据失败:', error);
                // 显示错误信息到页面
                showApiError('获取统计数据失败', error);
            }
        }

        // 显示API错误信息
        function showApiError(message, details) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger m-3';
            errorDiv.innerHTML = `
                <h5><i class="fas fa-exclamation-triangle"></i> ${message}</h5>
                <p><strong>详细信息:</strong> ${details.message || JSON.stringify(details)}</p>
                <p><strong>API地址:</strong> ${getApiBaseUrl()}/api/stats</p>
                <p><strong>配置文件:</strong> ${window.appConfig ? JSON.stringify(window.appConfig) : '未找到'}</p>
                <button class="btn btn-primary btn-sm" onclick="loadDashboardStats()">重试</button>
            `;

            // 在页面顶部显示错误
            const container = document.querySelector('.main-content') || document.body;
            container.insertBefore(errorDiv, container.firstChild);
        }

        // 更新统计卡片
        function updateStatCards(stats) {
            console.log('更新统计卡片，数据:', stats);

            // 更新样本总数
            const totalCasesElement = document.querySelector('.total-cases');
            if (totalCasesElement) {
                totalCasesElement.textContent = stats.count || 0;
            }

            // 更新平均分
            const averageScoreElement = document.querySelector('.average-score');
            if (averageScoreElement) {
                const avgScore = stats.overall_average;
                console.log('平均分:', avgScore);

                // 检查是否为特殊值 -1（表示数据库为空）
                if (avgScore === -1) {
                    averageScoreElement.textContent = "No Data";
                } else {
                    averageScoreElement.textContent = (avgScore || 0).toFixed(1);
                }
            }

            // 如果有维度平均分数据
            if (stats.dimension_averages) {
                console.log('维度平均分:', stats.dimension_averages);

                // 找出最高分和最低分的维度
                const dimensions = [
                    'hallucination_control',
                    'quality',
                    'professionalism',
                    'usefulness'
                ];

                let highestDim = '';
                let highestScore = -1;
                let lowestDim = '';
                let lowestScore = 101; // 初始值设为超过最大可能值

                dimensions.forEach(dim => {
                    const score = stats.dimension_averages[dim];
                    if (score !== undefined && score !== -1) {
                        console.log(`维度 ${dim} 得分:`, score);
                        if (score > highestScore) {
                            highestScore = score;
                            highestDim = dim;
                        }
                        if (score < lowestScore) {
                            lowestScore = score;
                            lowestDim = dim;
                        }
                    }
                });

                console.log('最高分维度:', highestDim, highestScore);
                console.log('最低分维度:', lowestDim, lowestScore);

                // 更新最高分维度
                const successRateElement = document.querySelector('.success-rate');
                if (successRateElement) {
                    if (highestScore === -1 || !highestDim) {
                        successRateElement.textContent = "No Data";
                    } else {
                        successRateElement.textContent = highestScore.toFixed(1);
                    }

                    // 更新标签
                    const label = successRateElement.nextElementSibling;
                    if (label) {
                        if (highestDim) {
                            label.textContent = `Highest: ${formatDimensionNameEn(highestDim)}`;
                        } else {
                            label.textContent = 'Highest: N/A';
                        }
                    }
                }

                // 更新最低分维度
                const lowestScoreElement = document.querySelector('.stat-number:not(.total-cases):not(.average-score):not(.success-rate)');
                if (lowestScoreElement) {
                    if (lowestScore === 101 || lowestScore === -1 || !lowestDim) {
                        lowestScoreElement.textContent = "No Data";
                    } else {
                        lowestScoreElement.textContent = lowestScore.toFixed(1);
                    }

                    // 更新标签
                    const label = lowestScoreElement.nextElementSibling;
                    if (label) {
                        if (lowestDim) {
                            label.textContent = `Lowest: ${formatDimensionNameEn(lowestDim)}`;
                        } else {
                            label.textContent = 'Lowest: N/A';
                        }
                    }
                }
            } else {
                console.warn('没有维度平均分数据');

                // 如果没有维度平均分数据，显示"No Data"
                const successRateElement = document.querySelector('.success-rate');
                if (successRateElement) {
                    successRateElement.textContent = "No Data";
                }

                const lowestScoreElement = document.querySelector('.stat-number:not(.total-cases):not(.average-score):not(.success-rate)');
                if (lowestScoreElement) {
                    lowestScoreElement.textContent = "No Data";
                }
            }
        }

        // 初始化所有图表
        function initializeCharts() {
            try {
                // Dashboard charts
                initializeDimensionChart();
                initializeCorrelationChart();
                initializeDistributionChart();

                // Performance charts
                initializeTimeTrendChart();
                initializeProductComparisonChart();
                initializeComplexityChart();
                initializeScoreDistributionChart();
            } catch (error) {
                console.error('初始化图表时出错:', error);
                // 显示错误消息
                showErrorMessage('图表初始化失败，请确保数据库中有数据。');
            }
        }

        // 显示错误消息
        function showErrorMessage(message) {
            // 创建错误消息元素
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger mt-3';
            errorDiv.role = 'alert';
            errorDiv.innerHTML = `<strong>错误:</strong> ${message}`;

            // 添加到页面
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                mainContent.prepend(errorDiv);
            }
        }

        // 初始化产品分布图表
        function initializeDimensionChart() {
            const chartDom = document.getElementById('dimension-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 显示加载动画
                myChart.showLoading({
                    text: 'Loading data...',
                    color: '#3B82F6',
                    textColor: '#000',
                    maskColor: 'rgba(255, 255, 255, 0.8)',
                    zlevel: 0
                });

                // 从后端获取产品数据
                fetchProductData()
                    .then(productData => {
                        // 隐藏加载动画
                        myChart.hideLoading();

                        // 处理产品数据
                        const processedData = processProductData(productData);

                        // 检查是否有数据
                        if (processedData.length === 0) {
                            // 显示无数据提示
                            myChart.setOption({
                                title: {
                                    text: '暂无数据',
                                    left: 'center',
                                    top: 'center',
                                    textStyle: {
                                        color: '#999',
                                        fontSize: 16
                                    }
                                }
                            });
                            return;
                        }

                        // 设置图表配置
                        const option = createProductChartOption(processedData);

                        // 应用图表配置
                        myChart.setOption(option);

                        // 响应窗口大小变化
                        window.addEventListener('resize', function() {
                            myChart.resize();
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching product data:', error);
                        myChart.hideLoading();

                        // 显示错误信息
                        myChart.setOption({
                            title: {
                                text: 'Error loading data',
                                left: 'center',
                                top: 'center',
                                textStyle: {
                                    color: '#EF4444',
                                    fontSize: 16
                                }
                            }
                        });
                    });
            }
        }

        // 从后端获取产品数据
        // 这个函数从专门的产品API端点获取数据
        async function fetchProductData() {
            try {
                // 显示加载消息
                console.log('正在从后端获取产品评分数据...');

                // 构建API URL
                const apiBaseUrl = getApiBaseUrl();
                const url = `${apiBaseUrl}/api/product-scores`;

                // 发起请求
                const response = await fetch(url);

                // 检查响应状态
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status} ${response.statusText}`);
                }

                // 解析响应数据
                const data = await response.json();

                // 检查数据格式
                if (!data || !data.products || !Array.isArray(data.products)) {
                    console.warn('后端返回的数据格式不正确:', data);
                    // 返回空数组，不使用模拟数据
                    return [];
                }

                // 转换产品数据为所需格式
                const rawData = transformProductData(data.products);
                console.log(`成功获取 ${rawData.length} 条产品评分数据`);

                return rawData;
            } catch (error) {
                console.error('获取产品评分数据失败:', error);
                // 返回错误，不使用模拟数据
                throw error;
            }
        }

        // 获取API基础URL
        function getApiBaseUrl() {
            // 优先使用配置文件中的设置
            if (window.appConfig && window.appConfig.apiBaseUrl) {
                return window.appConfig.apiBaseUrl;
            }

            // 如果没有配置文件，使用自动检测
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3000';
            } else {
                // 生产环境，使用当前主机的3000端口
                return `${window.location.protocol}//${window.location.hostname}:3000`;
            }
        }

        // 转换产品数据为所需格式
        function transformProductData(products) {
            return products.map(product => {
                // 提取产品ID
                const productId = product.product_id || 'unknown';

                // 提取各维度得分
                const scores = {};
                if (product.dimension_scores) {
                    Object.entries(product.dimension_scores).forEach(([dim, score]) => {
                        scores[formatDimensionNameEn(dim)] = score;
                    });
                }

                // 返回转换后的数据
                return {
                    id: productId,
                    productId: productId,
                    scores: scores,
                    averageScore: product.average_score || 0,
                    sampleCount: product.sample_count || 0
                };
            });
        }

        // 格式化维度名称（英文）
        function formatDimensionNameEn(dimension) {
            // 只保留4个实际使用的维度的映射
            const dimensionMapEn = {
                'hallucination_control': 'Hallucination Control',
                'quality': 'Quality',
                'professionalism': 'Professionalism',
                'usefulness': 'Usefulness'
            };

            return dimensionMapEn[dimension] || dimension.replace(/_/g, ' ');
        }

        // 生成模拟原始数据（当API请求失败时使用）
        function generateMockRawData(sampleCount) {
            const productIds = ['PN-1001', 'PN-1002', 'PN-1003', 'PN-1004'];
            const dimensions = ['Hallucination Control', 'Quality', 'Professionalism', 'Usefulness'];
            const rawData = [];

            for (let i = 0; i < sampleCount; i++) {
                // 随机选择一个产品ID
                const productId = productIds[Math.floor(Math.random() * productIds.length)];

                // 为每个维度生成随机得分 (50-100)
                const scores = {};
                dimensions.forEach(dim => {
                    scores[dim] = Math.floor(Math.random() * 51) + 50;
                });

                // 计算平均得分
                const avgScore = Object.values(scores).reduce((sum, score) => sum + score, 0) / dimensions.length;

                // 添加到原始数据
                rawData.push({
                    id: i + 1,
                    productId: productId,
                    scores: scores,
                    averageScore: avgScore
                });
            }

            return rawData;
        }

        // 处理产品数据 - 准备图表所需的数据格式
        function processProductData(rawData) {
            // 计算每个产品的图表数据
            const processedData = [];
            const colors = [
                '#3B82F6', '#10B981', '#EF4444', '#F59E0B',
                '#8B5CF6', '#EC4899', '#14B8A6', '#F97316'
            ];

            // 遍历产品数据
            rawData.forEach((product, index) => {
                // 添加到处理后的数据
                processedData.push({
                    name: product.productId,
                    value: product.averageScore,
                    sampleCount: product.sampleCount,
                    itemStyle: { color: colors[index % colors.length] }
                });
            });

            return processedData;
        }

        // 创建产品图表配置
        function createProductChartOption(processedData) {
            return {
                title: {
                    text: 'Product Average Scores',
                    left: 'center',
                    top: 0,
                    textStyle: {
                        fontSize: 14
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        // 查找对应的数据项
                        const item = processedData.find(item => item.name === params.name);

                        // 自定义提示框内容
                        return `${params.seriesName}<br/>
                                ${params.name}: ${params.value} points<br/>
                                Samples: ${item ? item.sampleCount : 0}<br/>
                                Proportion: ${params.percent}%`;
                    }
                },
                legend: {
                    type: 'scroll',
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    formatter: function(name) {
                        // 查找对应的数据项
                        const item = processedData.find(item => item.name === name);
                        return `${name}: ${item ? item.value : 0} pts (${item ? item.sampleCount : 0})`;
                    }
                },
                series: [
                    {
                        name: 'Product Score',
                        type: 'pie',
                        radius: ['40%', '70%'],
                        avoidLabelOverlap: false,
                        itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                        label: {
                            show: false,
                            position: 'center'
                        },
                        emphasis: {
                            label: {
                                show: true,
                                fontSize: '16',
                                fontWeight: 'bold',
                                formatter: '{b}: {c} points'
                            }
                        },
                        labelLine: {
                            show: false
                        },
                        data: processedData
                    }
                ]
            };
        }

        // 初始化相关性图表
        function initializeCorrelationChart() {
            const chartDom = document.getElementById('correlation-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 显示加载动画
                myChart.showLoading({
                    text: 'Loading data...',
                    color: '#3B82F6',
                    textColor: '#000',
                    maskColor: 'rgba(255, 255, 255, 0.8)',
                    zlevel: 0
                });

                // 从后端获取统计数据
                fetchStatsData()
                    .then(stats => {
                        // 隐藏加载动画
                        myChart.hideLoading();

                        // 处理维度数据
                        const dimensionData = processDimensionData(stats);

                        // 检查是否有数据
                        if (stats.count === 0) {
                            // 显示无数据提示
                            myChart.setOption({
                                title: {
                                    text: '暂无数据',
                                    left: 'center',
                                    top: 'center',
                                    textStyle: {
                                        color: '#999',
                                        fontSize: 16
                                    }
                                }
                            });
                            return;
                        }

                        // 设置图表配置
                        const option = {
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'shadow'
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true
                            },
                            xAxis: {
                                type: 'category',
                                data: dimensionData.map(item => item.name)
                            },
                            yAxis: {
                                type: 'value',
                                min: 0,
                                max: 100
                            },
                            series: [
                                {
                                    name: 'Score',
                                    type: 'bar',
                                    data: dimensionData.map(item => ({
                                        value: item.value,
                                        itemStyle: { color: item.color }
                                    })),
                                    showBackground: true,
                                    backgroundStyle: {
                                        color: 'rgba(180, 180, 180, 0.2)'
                                    }
                                }
                            ]
                        };

                        myChart.setOption(option);

                        // 响应窗口大小变化
                        window.addEventListener('resize', function() {
                            myChart.resize();
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching stats data:', error);
                        myChart.hideLoading();

                        // 显示错误信息
                        myChart.setOption({
                            title: {
                                text: 'Error loading data',
                                left: 'center',
                                top: 'center',
                                textStyle: {
                                    color: '#EF4444',
                                    fontSize: 16
                                }
                            }
                        });
                    });
            }
        }

        // 从后端获取统计数据
        async function fetchStatsData() {
            try {
                // 构建API URL
                const apiBaseUrl = getApiBaseUrl();
                const url = `${apiBaseUrl}/api/stats`;

                // 发起请求
                const response = await fetch(url);

                // 检查响应状态
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status} ${response.statusText}`);
                }

                // 解析响应数据
                const data = await response.json();

                // 检查数据格式
                if (!data || !data.stats) {
                    console.warn('后端返回的统计数据格式不正确:', data);
                    // 返回空对象，不使用模拟数据
                    return {
                        count: 0,
                        overall_average: 0,
                        dimension_averages: {
                            hallucination_control: 0,
                            quality: 0,
                            professionalism: 0,
                            usefulness: 0
                        }
                    };
                }

                return data.stats;
            } catch (error) {
                console.error('获取统计数据失败:', error);
                // 返回错误，不使用模拟数据
                throw error;
            }
        }

        // 生成模拟统计数据
        function generateMockStatsData() {
            return {
                count: 4,
                overall_average: 82,
                dimension_averages: {
                    hallucination_control: 80,
                    quality: 70,
                    professionalism: 65,
                    usefulness: 50,
                    average_score: 82
                }
            };
        }

        // 处理维度数据
        function processDimensionData(stats) {
            // 定义维度和颜色
            const dimensions = [
                { key: 'usefulness', name: 'Usefulness', color: '#F59E0B' },
                { key: 'professionalism', name: 'Professionalism', color: '#EF4444' },
                { key: 'quality', name: 'Quality', color: '#10B981' },
                { key: 'hallucination_control', name: 'Hallucination Control', color: '#3B82F6' }
            ];

            // 如果没有维度平均分数据，返回默认值
            if (!stats || !stats.dimension_averages) {
                return dimensions.map(dim => ({
                    name: dim.name,
                    value: 0,
                    color: dim.color
                }));
            }

            // 处理维度数据
            return dimensions.map(dim => ({
                name: dim.name,
                value: stats.dimension_averages[dim.key] || 0,
                color: dim.color
            }));
        }

        // 初始化分布图表
        function initializeDistributionChart() {
            const chartDom = document.getElementById('distribution-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 显示加载动画
                myChart.showLoading({
                    text: 'Loading data...',
                    color: '#3B82F6',
                    textColor: '#000',
                    maskColor: 'rgba(255, 255, 255, 0.8)',
                    zlevel: 0
                });

                // 从后端获取统计数据
                fetchStatsData()
                    .then(stats => {
                        // 隐藏加载动画
                        myChart.hideLoading();

                        // 处理维度数据
                        const dimensionData = processDimensionData(stats);

                        // 检查是否有数据
                        if (stats.count === 0) {
                            // 显示无数据提示
                            myChart.setOption({
                                title: {
                                    text: '暂无数据',
                                    left: 'center',
                                    top: 'center',
                                    textStyle: {
                                        color: '#999',
                                        fontSize: 16
                                    }
                                }
                            });
                            return;
                        }

                        // 设置图表配置
                        const option = {
                            tooltip: {
                                trigger: 'axis'
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true
                            },
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: dimensionData.map(item => item.name)
                            },
                            yAxis: {
                                type: 'value',
                                min: 0,
                                max: 100
                            },
                            series: [
                                {
                                    name: 'Score',
                                    type: 'line',
                                    data: dimensionData.map(item => item.value),
                                    smooth: true,
                                    symbol: 'circle',
                                    symbolSize: 8,
                                    lineStyle: {
                                        width: 3,
                                        color: '#3B82F6'
                                    },
                                    itemStyle: {
                                        color: '#3B82F6'
                                    },
                                    areaStyle: {
                                        color: {
                                            type: 'linear',
                                            x: 0,
                                            y: 0,
                                            x2: 0,
                                            y2: 1,
                                            colorStops: [
                                                {
                                                    offset: 0,
                                                    color: 'rgba(59, 130, 246, 0.3)'
                                                },
                                                {
                                                    offset: 1,
                                                    color: 'rgba(59, 130, 246, 0.1)'
                                                }
                                            ]
                                        }
                                    }
                                }
                            ]
                        };

                        myChart.setOption(option);

                        // 响应窗口大小变化
                        window.addEventListener('resize', function() {
                            myChart.resize();
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching stats data:', error);
                        myChart.hideLoading();

                        // 显示错误信息
                        myChart.setOption({
                            title: {
                                text: 'Error loading data',
                                left: 'center',
                                top: 'center',
                                textStyle: {
                                    color: '#EF4444',
                                    fontSize: 16
                                }
                            }
                        });
                    });
            }
        }

        // 初始化时间趋势图表
        function initializeTimeTrendChart() {
            const chartDom = document.getElementById('time-trend-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 显示加载动画
                myChart.showLoading({
                    text: 'Loading data...',
                    color: '#3B82F6',
                    textColor: '#000',
                    maskColor: 'rgba(255, 255, 255, 0.8)',
                    zlevel: 0
                });

                // 从后端获取统计数据
                fetchStatsData()
                    .then(stats => {
                        // 隐藏加载动画
                        myChart.hideLoading();

                        // 检查是否有数据
                        if (stats.count === 0) {
                            // 显示无数据提示
                            myChart.setOption({
                                title: {
                                    text: '暂无数据',
                                    left: 'center',
                                    top: 'center',
                                    textStyle: {
                                        color: '#999',
                                        fontSize: 16
                                    }
                                }
                            });
                            return;
                        }

                        // 图表配置
                        const option = {
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['Hallucination Control', 'Quality', 'Professionalism', 'Usefulness', 'Average']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['5/12', '5/13', '5/14', '5/15', '5/16', '5/17', '5/18']
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: 100
                    },
                    series: [
                        {
                            name: 'Hallucination Control',
                            type: 'line',
                            data: [78, 80, 82, 88, 78, 92, 85],
                            smooth: true,
                            lineStyle: {
                                color: '#3B82F6'
                            }
                        },
                        {
                            name: 'Quality',
                            type: 'line',
                            data: [72, 75, 78, 82, 72, 85, 78],
                            smooth: true,
                            lineStyle: {
                                color: '#10B981'
                            }
                        },
                        {
                            name: 'Professionalism',
                            type: 'line',
                            data: [68, 70, 72, 75, 68, 80, 72],
                            smooth: true,
                            lineStyle: {
                                color: '#EF4444'
                            }
                        },
                        {
                            name: 'Usefulness',
                            type: 'line',
                            data: [60, 62, 65, 70, 60, 75, 65],
                            smooth: true,
                            lineStyle: {
                                color: '#F59E0B'
                            }
                        },
                        {
                            name: 'Average',
                            type: 'line',
                            data: [69.5, 71.8, 74.3, 78.8, 69.5, 83.0, 75.0],
                            smooth: true,
                            lineStyle: {
                                width: 3,
                                color: '#1F2937'
                            },
                            symbolSize: 8
                        }
                    ]
                };

                        myChart.setOption(option);

                        // 响应窗口大小变化
                        window.addEventListener('resize', function() {
                            myChart.resize();
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching stats data:', error);
                        myChart.hideLoading();

                        // 显示错误信息
                        myChart.setOption({
                            title: {
                                text: 'Error loading data',
                                left: 'center',
                                top: 'center',
                                textStyle: {
                                    color: '#EF4444',
                                    fontSize: 16
                                }
                            }
                        });
                    });
            }
        }

        // 初始化产品系列对比图表
        function initializeProductComparisonChart() {
            const chartDom = document.getElementById('product-comparison-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 图表配置
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['Hallucination Control', 'Quality', 'Professionalism', 'Usefulness']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        min: 0,
                        max: 100
                    },
                    yAxis: {
                        type: 'category',
                        data: ['Enterprise Storage', 'Cloud Services', 'Security Solutions']
                    },
                    series: [
                        {
                            name: 'Hallucination Control',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [85, 92, 78],
                            itemStyle: {
                                color: '#3B82F6'
                            }
                        },
                        {
                            name: 'Quality',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [78, 85, 72],
                            itemStyle: {
                                color: '#10B981'
                            }
                        },
                        {
                            name: 'Professionalism',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [72, 80, 68],
                            itemStyle: {
                                color: '#EF4444'
                            }
                        },
                        {
                            name: 'Usefulness',
                            type: 'bar',
                            stack: 'total',
                            label: {
                                show: true
                            },
                            emphasis: {
                                focus: 'series'
                            },
                            data: [65, 75, 60],
                            itemStyle: {
                                color: '#F59E0B'
                            }
                        }
                    ]
                };

                myChart.setOption(option);

                // 响应窗口大小变化
                window.addEventListener('resize', function() {
                    myChart.resize();
                });
            }
        }

        // 初始化复杂度分布图表
        function initializeComplexityChart() {
            const chartDom = document.getElementById('complexity-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 图表配置
                const option = {
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        right: 10,
                        top: 'center'
                    },
                    series: [
                        {
                            name: 'Complexity Distribution',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                                borderRadius: 10,
                                borderColor: '#fff',
                                borderWidth: 2
                            },
                            label: {
                                show: false,
                                position: 'center'
                            },
                            emphasis: {
                                label: {
                                    show: true,
                                    fontSize: '16',
                                    fontWeight: 'bold'
                                }
                            },
                            labelLine: {
                                show: false
                            },
                            data: [
                                { value: 25, name: 'Low Complexity', itemStyle: { color: '#10B981' } },
                                { value: 50, name: 'Medium Complexity', itemStyle: { color: '#F59E0B' } },
                                { value: 25, name: 'High Complexity', itemStyle: { color: '#EF4444' } }
                            ]
                        }
                    ]
                };

                myChart.setOption(option);

                // 响应窗口大小变化
                window.addEventListener('resize', function() {
                    myChart.resize();
                });
            }
        }

        // 初始化分数分布图表
        function initializeScoreDistributionChart() {
            const chartDom = document.getElementById('score-distribution-chart');
            if (chartDom) {
                const myChart = echarts.init(chartDom);

                // 图表配置
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: ['0-10', '11-20', '21-30', '31-40', '41-50', '51-60', '61-70', '71-80', '81-90', '91-100']
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                            name: 'Score Distribution',
                            type: 'bar',
                            data: [
                                {
                                    value: 0,
                                    itemStyle: { color: '#EF4444' }
                                },
                                {
                                    value: 0,
                                    itemStyle: { color: '#EF4444' }
                                },
                                {
                                    value: 0,
                                    itemStyle: { color: '#EF4444' }
                                },
                                {
                                    value: 0,
                                    itemStyle: { color: '#F59E0B' }
                                },
                                {
                                    value: 1,
                                    itemStyle: { color: '#F59E0B' }
                                },
                                {
                                    value: 2,
                                    itemStyle: { color: '#F59E0B' }
                                },
                                {
                                    value: 5,
                                    itemStyle: { color: '#10B981' }
                                },
                                {
                                    value: 8,
                                    itemStyle: { color: '#10B981' }
                                },
                                {
                                    value: 3,
                                    itemStyle: { color: '#3B82F6' }
                                },
                                {
                                    value: 1,
                                    itemStyle: { color: '#3B82F6' }
                                }
                            ],
                            showBackground: true,
                            backgroundStyle: {
                                color: 'rgba(180, 180, 180, 0.2)'
                            }
                        }
                    ]
                };

                myChart.setOption(option);

                // 响应窗口大小变化
                window.addEventListener('resize', function() {
                    myChart.resize();
                });
            }
        }

        // 图表放大和下载功能
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化模态对话框
            const chartModal = new bootstrap.Modal(document.getElementById('chartModal'));

            // 处理放大按钮点击事件
            document.querySelectorAll('.expand-chart').forEach(button => {
                button.addEventListener('click', function() {
                    const chartId = this.getAttribute('data-chart');
                    const chartElement = document.getElementById(chartId);
                    const chartTitle = this.closest('.card-header').querySelector('span').textContent;

                    // 设置模态对话框标题
                    document.getElementById('chartModalLabel').textContent = chartTitle;

                    // 显示模态对话框
                    chartModal.show();

                    // 在模态对话框中创建图表
                    setTimeout(() => {
                        const modalChartContainer = document.getElementById('modalChartContainer');

                        // 获取原始图表实例
                        const originalChart = echarts.getInstanceByDom(chartElement);
                        const originalOption = originalChart.getOption();

                        // 创建新的图表实例
                        const modalChart = echarts.init(modalChartContainer);
                        modalChart.setOption(originalOption);

                        // 响应窗口大小变化
                        window.addEventListener('resize', function() {
                            modalChart.resize();
                        });

                        // 当模态对话框关闭时销毁图表实例
                        document.getElementById('chartModal').addEventListener('hidden.bs.modal', function() {
                            modalChart.dispose();
                        });

                        // 处理模态对话框中的下载按钮
                        document.getElementById('downloadModalChart').onclick = function() {
                            // 将图表转换为图片
                            const url = modalChart.getDataURL({
                                type: 'png',
                                pixelRatio: 2,
                                backgroundColor: '#fff'
                            });

                            // 创建下载链接
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = chartTitle.replace(/\s+/g, '_') + '.png';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        };
                    }, 300);
                });
            });

            // 处理下载按钮点击事件
            document.querySelectorAll('.download-chart').forEach(button => {
                button.addEventListener('click', function() {
                    const chartId = this.getAttribute('data-chart');
                    const chartElement = document.getElementById(chartId);
                    const chartTitle = this.closest('.card-header').querySelector('span').textContent;

                    // 获取图表实例
                    const chart = echarts.getInstanceByDom(chartElement);

                    // 将图表转换为图片
                    const url = chart.getDataURL({
                        type: 'png',
                        pixelRatio: 2,
                        backgroundColor: '#fff'
                    });

                    // 创建下载链接
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = chartTitle.replace(/\s+/g, '_') + '.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
            });
        });
    </script>

    <!-- 图表放大模态对话框 -->
    <div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chartModalLabel">Chart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="modalChartContainer" style="height: 500px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="downloadModalChart">Download</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
